// ë¹„ë””ì˜¤ í’ˆì§ˆ ìµœì í™” ìŠ¤í¬ë¦½íŠ¸
document.addEventListener('DOMContentLoaded', function() {
  const video = document.querySelector('.hero-video');
  
  if (video) {
    console.log('ğŸ¬ ê³ í™”ì§ˆ ë¹„ë””ì˜¤ ìµœì í™” ì‹œì‘...');
    
    // ë””ë°”ì´ìŠ¤ë³„ ìµœì  ë¹„ë””ì˜¤ ì„ íƒ
    function selectOptimalVideo() {
      const screenWidth = window.screen.width;
      const pixelRatio = window.devicePixelRatio || 1;
      const effectiveWidth = screenWidth * pixelRatio;
      
      console.log('ğŸ“± ë””ë°”ì´ìŠ¤ ì •ë³´:', {
        screenWidth,
        pixelRatio,
        effectiveWidth
      });
      
      // ê³ í•´ìƒë„ ë””ìŠ¤í”Œë ˆì´ ê°ì§€
      if (effectiveWidth >= 3840) {
        // 4K ë””ìŠ¤í”Œë ˆì´
        updateVideoSource('background_4k.mp4', 'background_hq.webm');
      } else if (effectiveWidth >= 2560) {
        // 2K ë””ìŠ¤í”Œë ˆì´  
        updateVideoSource('background_2k.mp4', 'background_hq.webm');
      } else if (effectiveWidth >= 1920) {
        // Full HD
        updateVideoSource('background_hq.mp4', 'background_hq.webm');
      } else {
        // HD
        updateVideoSource('background_1080p.mp4', 'background_hq.webm');
      }
    }
    
    function updateVideoSource(mp4File, webmFile) {
      const sources = video.querySelectorAll('source');
      if (sources.length >= 2) {
        sources[0].src = `/static/images/${mp4File}`;
        sources[1].src = `/static/images/${webmFile}`;
        video.load(); // ë¹„ë””ì˜¤ ë‹¤ì‹œ ë¡œë“œ
        console.log('ğŸ“¹ ë¹„ë””ì˜¤ ì†ŒìŠ¤ ì—…ë°ì´íŠ¸:', mp4File);
      }
    }
    
    // ë¹„ë””ì˜¤ í’ˆì§ˆ ì„¤ì •
    video.addEventListener('loadedmetadata', function() {
      console.log('ğŸ“Š ë¹„ë””ì˜¤ ë©”íƒ€ë°ì´í„° ë¡œë“œë¨:', {
        width: video.videoWidth,
        height: video.videoHeight,
        duration: video.duration
      });
      
      // ê³ í™”ì§ˆ ì„¤ì •
      if (video.videoWidth && video.videoHeight) {
        // ë¹„ë””ì˜¤ ì›ë³¸ í•´ìƒë„ í™•ì¸
        const aspectRatio = video.videoWidth / video.videoHeight;
        const containerWidth = video.offsetWidth;
        const containerHeight = video.offsetHeight;
        
        console.log('ğŸ¯ í™”ë©´ ë¹„ìœ¨ ìµœì í™”:', {
          videoAspectRatio: aspectRatio,
          containerSize: `${containerWidth}x${containerHeight}`
        });
      }
    });
    
    // ë¹„ë””ì˜¤ ë¡œë”© ìµœì í™”
    video.addEventListener('loadstart', function() {
      console.log('â³ ë¹„ë””ì˜¤ ë¡œë”© ì‹œì‘...');
    });
    
    video.addEventListener('canplaythrough', function() {
      console.log('âœ… ë¹„ë””ì˜¤ ì™„ì „ ë¡œë“œ ì™„ë£Œ - ê³ í™”ì§ˆ ì¬ìƒ ì¤€ë¹„ë¨');
      
      // ì¬ìƒ í’ˆì§ˆ í–¥ìƒì„ ìœ„í•œ ì„¤ì •
      video.style.imageRendering = 'high-quality';
      video.style.imageRendering = '-webkit-optimize-contrast';
    });
    
    // ì—ëŸ¬ ì²˜ë¦¬
    video.addEventListener('error', function(e) {
      console.error('âŒ ë¹„ë””ì˜¤ ë¡œë“œ ì—ëŸ¬:', e);
      console.log('ğŸ”„ í´ë°± ì´ë¯¸ì§€ë¡œ ì „í™˜ ì‹œë„...');
      
      // í´ë°± ì´ë¯¸ì§€ í‘œì‹œ
      const fallbackImg = document.createElement('img');
      fallbackImg.src = '/static/images/video-fallback.jpg';
      fallbackImg.style.cssText = video.style.cssText;
      fallbackImg.className = 'hero-video-fallback';
      video.parentNode.replaceChild(fallbackImg, video);
    });
    
    // ì¬ìƒ ìµœì í™”
    video.addEventListener('play', function() {
      console.log('â–¶ï¸ ë¹„ë””ì˜¤ ì¬ìƒ ì‹œì‘ - í™”ì§ˆ ìµœì í™” ì ìš©ë¨');
    });
    
    // ëª¨ë°”ì¼ ëŒ€ì‘
    if (window.innerWidth <= 768) {
      video.style.filter = 'contrast(1.1) brightness(0.9) saturate(1.1)';
      console.log('ğŸ“± ëª¨ë°”ì¼ ìµœì í™” í•„í„° ì ìš©');
    }
    
    // ê³ í•´ìƒë„ ë””ìŠ¤í”Œë ˆì´ ê°ì§€
    if (window.devicePixelRatio > 1) {
      video.style.transform = `scale(${1/window.devicePixelRatio}) translateZ(0)`;
      video.style.transformOrigin = 'top left';
      video.style.width = `${100 * window.devicePixelRatio}%`;
      video.style.height = `${100 * window.devicePixelRatio}%`;
      console.log(`ğŸ–¥ï¸ ê³ í•´ìƒë„ ë””ìŠ¤í”Œë ˆì´ ìµœì í™” (${window.devicePixelRatio}x)`);
    }
  }
});